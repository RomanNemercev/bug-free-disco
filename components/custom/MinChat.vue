<!-- components/custom/MinChat.vue -->
<script setup>
  import { ref, nextTick } from 'vue'

  // Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¸ Ñ„Ð°Ð¹Ð»Ñ‹
  const messageContent = ref(
    'ÐœÑ‹ Ð¸Ñ‰ÐµÐ¼ Ñ‚Ð°Ð»Ð°Ð½Ñ‚Ð»Ð¸Ð²Ð¾Ð³Ð¾ Ð¸ Ð°Ð¼Ð±Ð¸Ñ†Ð¸Ð¾Ð·Ð½Ð¾Ð³Ð¾ ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð° Ð¿Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ Ñ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ð¼Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÑÐ¼Ð¾Ð¶ÐµÑ‚ Ð²Ð½ÐµÑÑ‚Ð¸ ÑÐ²Ð¾Ð¹ Ð²ÐºÐ»Ð°Ð´ Ð² Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ðµ Ð½Ð°ÑˆÐµÐ³Ð¾ Ð±Ð¸Ð·Ð½ÐµÑÐ° Ð¸ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ ÑƒÑÐ¿ÐµÑ…Ð°. Ð•ÑÐ»Ð¸ Ð²Ñ‹ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹ Ðº Ð½Ð¾Ð²Ñ‹Ð¼ Ð²Ñ‹Ð·Ð¾Ð²Ð°Ð¼ Ð¸ ÑÑ‚Ñ€ÐµÐ¼Ð¸Ñ‚ÐµÑÑŒ Ðº Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð¼Ñƒ Ñ€Ð¾ÑÑ‚Ñƒ, ÑÑ‚Ð° Ð²Ð°ÐºÐ°Ð½ÑÐ¸Ñ Ð´Ð»Ñ Ð²Ð°Ñ. ÐœÑ‹ Ð¸Ñ‰ÐµÐ¼ Ñ‚Ð°Ð»Ð°Ð½Ñ‚Ð»Ð¸Ð²Ð¾Ð³Ð¾ Ð¸ Ð°Ð¼Ð±Ð¸Ñ†Ð¸Ð¾Ð·Ð½Ð¾Ð³Ð¾ ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð° Ð¿Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ Ñ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ð¼Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÑÐ¼Ð¾Ð¶ÐµÑ‚ Ð²Ð½ÐµÑÑ‚Ð¸ ÑÐ²Ð¾Ð¹ Ð²ÐºÐ»Ð°Ð´ Ð² Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ðµ Ð½Ð°ÑˆÐµÐ³Ð¾ Ð±Ð¸Ð·Ð½ÐµÑÐ° Ð¸ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ ÑƒÑÐ¿ÐµÑ…Ð°. Ð•ÑÐ»Ð¸ Ð²Ñ‹ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹ Ðº Ð½Ð¾Ð²Ñ‹Ð¼ Ð²Ñ‹Ð·Ð¾Ð²Ð°Ð¼ Ð¸ ÑÑ‚Ñ€ÐµÐ¼Ð¸Ñ‚ÐµÑÑŒ Ðº Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð¼Ñƒ Ñ€Ð¾ÑÑ‚Ñƒ, ÑÑ‚Ð° Ð²Ð°ÐºÐ°Ð½ÑÐ¸Ñ Ð´Ð»Ñ Ð²Ð°ÑÐœÑ‹ Ð¸Ñ‰ÐµÐ¼ Ñ‚Ð°Ð»Ð°Ð½Ñ‚Ð»Ð¸Ð²Ð¾Ð³Ð¾ Ð¸ Ð°Ð¼Ð±Ð¸Ñ†Ð¸Ð¾Ð·Ð½Ð¾Ð³Ð¾ ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð° Ð¿Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ Ñ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ð¼Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÑÐ¼Ð¾Ð¶ÐµÑ‚ Ð²Ð½ÐµÑÑ‚Ð¸ ÑÐ²Ð¾Ð¹ Ð²ÐºÐ»Ð°Ð´ Ð² Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ðµ Ð½Ð°ÑˆÐµÐ³Ð¾ Ð±Ð¸Ð·Ð½ÐµÑÐ° Ð¸ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ ÑƒÑÐ¿ÐµÑ…Ð°. Ð•ÑÐ»Ð¸ Ð²Ñ‹ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹ Ðº Ð½Ð¾Ð²Ñ‹Ð¼ Ð²Ñ‹Ð·Ð¾Ð²Ð°Ð¼ Ð¸ ÑÑ‚Ñ€ÐµÐ¼Ð¸Ñ‚ÐµÑÑŒ Ðº Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð¼Ñƒ Ñ€Ð¾ÑÑ‚Ñƒ, ÑÑ‚Ð° Ð²Ð°ÐºÐ°Ð½ÑÐ¸Ñ Ð´Ð»Ñ Ð²Ð°ÑÐœÑ‹ Ð¸Ñ‰ÐµÐ¼ Ñ‚Ð°Ð»Ð°Ð½Ñ‚Ð»Ð¸Ð²Ð¾Ð³Ð¾ Ð¸ Ð°Ð¼Ð±Ð¸Ñ†Ð¸Ð¾Ð·Ð½Ð¾Ð³Ð¾ ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð° Ð¿Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ Ñ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ð¼Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÑÐ¼Ð¾Ð¶ÐµÑ‚ Ð²Ð½ÐµÑÑ‚Ð¸ ÑÐ²Ð¾Ð¹ Ð²ÐºÐ»Ð°Ð´ Ð² Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ðµ Ð½Ð°ÑˆÐµÐ³Ð¾ Ð±Ð¸Ð·Ð½ÐµÑÐ° Ð¸ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ ÑƒÑÐ¿ÐµÑ…Ð°. Ð•ÑÐ»Ð¸ Ð²Ñ‹ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹ Ðº Ð½Ð¾Ð²Ñ‹Ð¼ Ð²Ñ‹Ð·Ð¾Ð²Ð°Ð¼ Ð¸ ÑÑ‚Ñ€ÐµÐ¼Ð¸Ñ‚ÐµÑÑŒ Ðº Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð¼Ñƒ Ñ€Ð¾ÑÑ‚Ñƒ, ÑÑ‚Ð° Ð²Ð°ÐºÐ°Ð½ÑÐ¸Ñ Ð´Ð»Ñ Ð²Ð°Ñ'
  )
  const attachedFiles = ref([
    { name: 'Frame 4962938.png', format: 'png' },
    { name: 'Frame 1233.png', format: 'png' },
  ])
  const textareaRef = ref(null)

  // Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð²
  const handleFileAttach = event => {
    const files = event.target.files
    for (let file of files) {
      attachedFiles.value.push({
        name: file.name,
        format: file.name.split('.').pop(),
      })
    }
  }

  // Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð°
  const removeFile = index => {
    attachedFiles.value.splice(index, 1)
  }

  // ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ (Ð´Ð»Ñ Ð¿Ñ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿Ð° Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð² timeline)
  const messages = ref([]) // Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿Ð°
  const sendMessage = () => {
    if (!messageContent.value.trim()) return

    messages.value.push({
      id: messages.value.length + 1,
      type: 'standard',
      author: 'Ð’Ñ‹', // Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ
      content: messageContent.value,
      dateTime: new Date().toISOString(),
    })

    // Ð¡Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ Ñ„Ð¾Ñ€Ð¼Ñƒ
    messageContent.value = ''
    attachedFiles.value = []
    autoResize()
  }

  // Ð”Ð»Ñ Ð¿Ñ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿Ð°: Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‘Ð¼ messages Ð² MinTimeline Ñ‡ÐµÑ€ÐµÐ· provide/inject
  import { provide } from 'vue'
  provide('messages', messages)

  const autoResize = () => {
    nextTick(() => {
      const textarea = textareaRef.value
      if (!textarea) return

      textarea.style.height = 'auto'
      textarea.style.height = `${textarea.scrollHeight}px`

      //   if content empty than remove scroll
      if (!messageContent.value || textarea.scrollHeight <= 40) {
        textarea.style.overflowY = 'hidden'
        textarea.style.height = '40px'
      } else {
        textarea.style.overflow = 'auto'
      }
    })
  }
</script>

<template>
  <div>
    <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿Ñ€Ð¸ÐºÑ€ÐµÐ¿Ð»Ñ‘Ð½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð² -->
    <div v-if="attachedFiles.length" class="file-list flex">
      <div
        v-for="(file, index) in attachedFiles"
        :key="index"
        class="text-sm font-medium flex items-center text-dodger"
      >
        <span>{{ file.name }}</span>
        <button @click="removeFile(index)" class="ml-5px">
          <svg-icon name="cross15" width="15" height="15" />
        </button>
      </div>
    </div>

    <!-- ÐžÐ±Ð»Ð°ÑÑ‚ÑŒ Ð²Ð²Ð¾Ð´Ð° -->
    <div class="flex items-end relative p-15px bg-white">
      <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¿Ñ€Ð¸ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ -->
      <label
        class="attach-btn flex items-center justify-center w-10 h-10 rounded cursor-pointer"
        :class="{
          'bg-gray-300': attachedFiles.length,
          'bg-gray-100': !attachedFiles.length,
        }"
      >
        <span>{{ attachedFiles.length ? attachedFiles.length : 'ðŸ“Ž' }}</span>
        <input type="file" multiple class="hidden" @change="handleFileAttach" />
      </label>

      <!-- ÐŸÐ¾Ð»Ðµ Ð²Ð²Ð¾Ð´Ð° -->
      <textarea
        ref="textareaRef"
        v-model="messageContent"
        rows="1"
        class="flex-1 p-2 border rounded resize-none min-h-[40px] max-h-[180px]"
        placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ..."
        @input="autoResize"
      ></textarea>

      <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ -->
      <button
        @click="sendMessage"
        class="send-btn bg-blue-500 text-white px-4 py-2 rounded"
      >
        ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ
      </button>
    </div>
  </div>
</template>

<style scoped>
  .file-list {
    flex-wrap: wrap;
    padding: 10px 15px;
    column-gap: 15px;
    row-gap: 10px;
    background-color: #e8f1ff;
  }
  textarea {
    width: 100%;
    box-sizing: border-box;
    overflow-y: hidden;
  }
  .attach-btn {
    transition: background-color 0.3s;
  }
</style>
